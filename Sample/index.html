<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script type="text/javascript">
     async function sendPrompt(prompt = '') {
        console.log("hogehoge");
	let API_KEY = ''

	// promptがない場合
	if (!prompt) return

	const response = await fetch('https://api.openai.com/v1/chat/completions', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
			Authorization: `Bearer ${API_KEY}`,
		},
		body: JSON.stringify({
  model: "gpt-3.5-turbo",
  //messages: [{role: "system", content: "あなたは要求された内容を実現するA-FrameのPrimitiveのHTMLタグのみを回答します。<a-scene>不要。HTMLのコードブロック(```html ＋ 回答```)形式"},{role: "user", content: "A-Frameで青くてアニメーションで自転するboxを目の前に表示するタグ"}],
    //messages: [{role: "system", content: "あなたは要求された内容を実現するため、A-FrameのPrimitiveなHTMLタグのみを提供します。<a-scene>不要。回答はHTMLのコードブロック形式"},{role: "user", content: "x方向に3個、z方向に3個、合計9個で色はランダム、大きさは0.5のboxをカメラの前に配置するタグ。各boxはanimationで自転"}],
      messages: [{role: "system", content: "あなたは要求された内容を実現するため、A-FrameのPrimitiveなHTMLタグのみを提供します。<a-scene>不要。回答はHTMLのコードブロック形式"},{role: "user", content: prompt}],
}),
	})

	const data = await response.json()
    var text=data.choices[0].message.content;
	console.log(text)
    const regex = /```(?:html)?\n([\s\S]*?)\n```/;
const match = regex.exec(text);
console.log(match);
const htmlTag = match[1];

console.log(htmlTag);
if(!htmlTag) return;
const container = document.getElementById('container');
const aFrameTag = document.createElement('div');
aFrameTag.innerHTML = htmlTag.trim();
//container.appendChild(aFrameTag.firstChild);
//boxWrapper.innerHTML = boxString.trim();
// container要素の子要素を削除
while (container.firstChild) {
  container.removeChild(container.firstChild);
}

while (aFrameTag.firstChild) {
  container.appendChild(aFrameTag.firstChild);
}
}

function addBox() {
  //get text from textarea
let prompt = document.querySelector('textarea').value;
sendPrompt(prompt);


}


    </script>
  </head>
  <body>
   <!-- <textarea id="input" rows="4" cols="50"></textarea>
    <button onclick="addBox()">Add Box</button>-->
    <a-scene>
        <a-entity id="container"></a-entity>
      <!--<a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
      <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
      <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>-->
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
<div style="position: fixed; top: 20px; left: 20px; width: 20%;">
  <textarea style="font-size: 20px; width: 100%; height: 300px;"></textarea>
  <button onclick="addBox()" style="display: block; margin-top: 20px;width: 100%; height: 50px;">Submit</button>
</div>
  </body>
</html>